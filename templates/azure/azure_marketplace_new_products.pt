# DEMO POLICY TEMPLATE. DOES NOT PRODUCE REAL RESULTS.
# More info available here: https://github.com/flexera-public/cco_demo
name "Azure New Marketplace Products [Demo]"
rs_pt_ver 20180301
type "policy"
short_description "Checks for snapshots older than a specified number of days and, optionally, deletes them. See the [README](https://github.com/flexera-public/policy_templates/tree/master/cost/aws/old_snapshots) and [docs.flexera.com/flexera/EN/Automation](https://docs.flexera.com/flexera/EN/Automation/AutomationGS.htm) to learn more."
long_description ""
# This is to make it easy to identify this template as a demo template via API
doc_link "https://github.com/flexera-public/cco_demo"
category "Cost"
severity "low"
default_frequency "weekly"
info(
  version: "0.5.3",
  provider: "Azure",
  service: "Marketplace",
  policy_set: "New Marketplace Products",
  recommendation_type: "",
  hide_skip_approvals: "true",
  demo: "true"
)

###############################################################################
# Parameters
###############################################################################

# This is to make it easy for automation to determine if an applied policy is
# a demo policy or not.
parameter "param_demo" do
  type "string"
  category "Policy Settings"
  label "Demo Policy"
  description "Indicates that this is a demo policy. Should generally be left at its default value."
  allowed_values "True", "False"
  default "True"
end

###############################################################################
# Datasources & Scripts
###############################################################################

datasource "ds_azure_marketplace_new_products_1" do
  request do
    verb "GET"
    host "raw.githubusercontent.com"
    path "/flexera-public/cco_demo/refs/heads/main/generated_data/fake_incident_tables/azure_marketplace_new_products_1.json"
  end
end

###############################################################################
# Policy
###############################################################################

policy "pol_incident" do
  validate_each $ds_azure_marketplace_new_products_1 do
    summary_template "Azure New Marketplace Products: {{ len data }} Azure New Marketplace Products Found"
    check eq(0, 1)
    export do
      resource_level false
      field "product" do
        label "New Product"
      end
      field "cost" do
        label "Estimated Monthly Cost"
      end
      field "currency" do
        label "Currency"
      end
    end
  end
end
